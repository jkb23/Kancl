stages:
  - build
  - end-to-end-tests
  - deploy

variables:
  HTTP_PORT: 8080
  HTTPS_PORT: 8081
  DOMAIN: ""
  MYSQL_USER: user
  MYSQL_PASSWORD: password
  MYSQL_ROOT_PASSWORD: rootpassword
  MYSQL_DATABASE: kanclOnline

build:
  stage: build
  image: maven:3.8.6-openjdk-11
  script:
    - mvn test
    - mvn package
  artifacts:
    untracked: false
    expire_in: 1 day
    paths:
      - target/server-1.0-SNAPSHOT.jar

end-to-end-tests:
  stage: end-to-end-tests
  image:
    name: jansimonek/caddy-maria-maven:0.1.2
    entrypoint: [""]   
  before_script:
    - ls
    - ls target
    - echo todo /scripts/run.sh
    - echo rm /etc/caddy/Caddyfile && cp run/Caddyfile /etc/caddy/Caddyfile
    - echo caddy run --config /etc/caddy/Caddyfile --adapter caddyfile &
  script:
    - echo run cypress

deploy:
  stage: deploy
  script:
    - echo "This job deploys something from the $CI_COMMIT_BRANCH branch."