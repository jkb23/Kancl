stages:
  - build
  - unit-tests
  - start-db
  - end-to-end-tests
  - deploy

variables:
  HTTP_PORT: 8080
  HTTPS_PORT: 8081
  DOMAIN: ""
  MYSQL_USER: user
  MYSQL_PASSWORD: password
  MYSQL_ROOT_PASSWORD: rootpassword
  MYSQL_DATABASE: kanclOnline

build:
  stage: build
  image:
    name: jansimonek/caddy-maria-maven:0.1.2
    entrypoint: [""]   
  script:
    - mvn package

unit-tests:
  stage: unit-tests
  script:
    - mvn test

start-db:
  stage: start-db
  script:
    - echo todo /scripts/run.sh

end-to-end-tests:
  stage: end-to-end-tests
  before_script:
    - rm /etc/caddy/Caddyfile && cp run/Caddyfile /etc/caddy/Caddyfile
    - caddy run --config /etc/caddy/Caddyfile --adapter caddyfile &
  script:
    - echo run cypress

deploy:
  stage: deploy
  script:
    - echo "This job deploys something from the $CI_COMMIT_BRANCH branch."